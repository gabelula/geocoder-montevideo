<!DOCTYPE html>
<html lang="es-UY">
  <head>
    <title>Geocoding Montevideo</title>
    <meta charset="utf8">
    <meta name="cloudmade-api-key" content="<%= API_KEY %>">
    <link href="http://fonts.googleapis.com/css?family=Arvo:bold&subset=latin" rel="stylesheet">
    <link href="/css/reset.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
  </head>
  <body>
    <header>
      <h1>Geocoding Montevideo</h1>
    </header>

    <section id="search">
      <form action="/geocode" method="get">
        <p><label for="address">Busca una dirección en Montevideo:</label></p>
        <p>
          <input autofocus type="text" name="address" id="address" value="<%= address %>">
          <button type="submit">Buscar</button>
        </p>
      </form>
    </section>

    <section id="results">
      <% if lat_long.exact_match? %>
        <dl>
          <dt>Latitud:</dt>
          <dd><%= lat_long.latitude %>&deg;N</dd>
          <dt>Longitud:</dt>
          <dd><%= lat_long.longitude %>&deg;E</dd>
        </dl>

        <img id="static-map" class="map"
          src="<%= Geocoder.map(lat_long.latitude, lat_long.longitude) %>"
          data-latitude="<%= lat_long.latitude %>"
          data-longitude="<%= lat_long.longitude %>"
          data-address="<%= address %>">
      <% elsif address && address.size > 0 %>
        <p class="error">No encontramos la dirección "<%= address %>".</p>
      <% end %>
    </section>

    <section id="api-docs">
      <h2>Herramientas para desarrolladores</h2>

      <p>Accede a esta página con el header <code>Accept: application/json</code>
        para obtener la respuesta en JSON. Por ejemplo:</p>

      <pre>$ curl -H "Accept: application/json" -G "http://<%= env["HTTP_HOST"] %>/geocode?address=18+de+julio+1860"
  { "response_code": "200",
    "latitude":      -34.90204,
    "longitude":     -56.17594,
    "address":       "18 de julio 1860" }</pre>

      <p>Cuando se encuentre la dirección en la base de datos el API retornará
        <strong><code>response_code: 200</code></strong>. Si la dirección no se
        encuentra, entonces se retornará <strong><code>response_code:
        404</code></strong>
    </section>

    <footer>
      <address>
        <a href="http://cuboxsa.com"><span>Hecho por </span><img src="/img/cubox.png" width="106" height="40"></a>
        <a href="http://cloudmade.com"><img src="/img/cloudmade.png" width="40" height="40"><span> provee los datos</span></a>
      </address>
    </footer>

    <% if lat_long.exact_match? %>
      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
      <script src="http://tile.cloudmade.com/wml/0.2/web-maps-lite.js"></script>
      <script src="/js/interactiveMap.js"></script>
    <% end %>
  </body>
</html>
